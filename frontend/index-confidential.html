<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bot Provisioner (Confidential Client)</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
    }
    h1 {
      color: #5e5e5e;
    }
    fieldset {
      margin: 20px 0;
      padding: 20px;
      border: 2px solid #ddd;
      border-radius: 8px;
    }
    legend {
      padding: 0 10px;
      font-weight: bold;
      color: #333;
    }
    button {
      background: #0078d4;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #106ebe;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    input[type="text"], input[type="url"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    .info-badge {
      background: #e6f3ff;
      color: #0078d4;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h1>Bot Provisioner (Confidential Client)</h1>
  <p>Provision a Microsoft Teams bot using OAuth 2.0 Authorization Code Flow with PKCE.</p>

  <div class="info-badge">
    <strong>Authentication Method:</strong> Authorization Code Flow (Confidential Client)
    <br>
    <strong>Server Port:</strong> 3002 (vs 3001 for public client)
  </div>

  <hr>

  <!-- Step 1: Authentication -->
  <fieldset id="step-1">
    <legend><strong>Step 1: Authenticate</strong></legend>

    <p>Authenticate with Microsoft 365 using OAuth 2.0 Authorization Code Flow</p>
    <button id="btn-auth">Sign in with Microsoft</button>

    <div id="auth-success" style="display: none;">
      <p>âœ“ Authenticated as: <span id="user-email"></span></p>
      <p>Tenant ID: <span id="tenant-id"></span></p>
      <p>Session ID: <span id="session-id"></span></p>
    </div>
  </fieldset>

  <hr>

  <!-- Step 2: Configuration -->
  <fieldset id="step-2" disabled>
    <legend><strong>Step 2: Configure Bot</strong></legend>

    <p>
      <label>Bot Name: <input type="text" id="bot-name" required></label>
    </p>
    <p>
      <label>Bot Endpoint (HTTPS): <input type="url" id="bot-endpoint" required pattern="https://.*"></label>
    </p>

    <button id="btn-start-provision">Start Provisioning</button>
  </fieldset>

  <hr>

  <!-- Step 3: Provisioning -->
  <fieldset id="step-3" disabled>
    <legend><strong>Step 3: Provisioning</strong></legend>

    <ul id="provision-status">
      <li id="provision-aad">Creating Azure AD App: <span>Waiting...</span></li>
      <li id="provision-secret">Generating Client Secret: <span>Waiting...</span></li>
      <li id="provision-teams">Creating Teams App: <span>Waiting...</span></li>
      <li id="provision-bot">Registering Bot: <span>Waiting...</span></li>
    </ul>

    <div id="provision-error" style="display: none;">
      <p><strong>Error:</strong> <span id="provision-error-message"></span></p>
      <button id="btn-retry">Retry</button>
    </div>
  </fieldset>

  <hr>

  <!-- Step 4: Complete -->
  <fieldset id="step-4" disabled>
    <legend><strong>Step 4: Credentials</strong></legend>

    <p><strong>Your bot has been provisioned. Here are your credentials:</strong></p>

    <table border="1" style="width: 100%; border-collapse: collapse;">
      <tr>
        <td style="padding: 8px;"><strong>CLIENT_ID</strong></td>
        <td style="padding: 8px;"><code id="cred-client-id"></code></td>
        <td style="padding: 8px;"><button class="btn-copy" data-copy="cred-client-id">Copy</button></td>
      </tr>
      <tr>
        <td style="padding: 8px;"><strong>CLIENT_SECRET</strong></td>
        <td style="padding: 8px;"><code id="cred-client-secret"></code></td>
        <td style="padding: 8px;"><button class="btn-copy" data-copy="cred-client-secret">Copy</button></td>
      </tr>
      <tr>
        <td style="padding: 8px;"><strong>TENANT_ID</strong></td>
        <td style="padding: 8px;"><code id="cred-tenant-id"></code></td>
        <td style="padding: 8px;"><button class="btn-copy" data-copy="cred-tenant-id">Copy</button></td>
      </tr>
      <tr>
        <td style="padding: 8px;"><strong>TEAMS_APP_ID</strong></td>
        <td style="padding: 8px;"><code id="cred-teams-app-id"></code></td>
        <td style="padding: 8px;"><button class="btn-copy" data-copy="cred-teams-app-id">Copy</button></td>
      </tr>
      <tr>
        <td style="padding: 8px;"><strong>BOT_ENDPOINT</strong></td>
        <td style="padding: 8px;"><code id="cred-bot-endpoint"></code></td>
        <td style="padding: 8px;"><button class="btn-copy" data-copy="cred-bot-endpoint">Copy</button></td>
      </tr>
    </table>

    <h3>.env file content:</h3>
    <pre id="env-file-content" style="background: #f5f5f5; padding: 15px; border-radius: 4px;"></pre>
    <button id="btn-download-env">Download .env</button>

    <hr>
    <button id="btn-start-over">Start Over</button>
  </fieldset>

  <script src="app-confidential.js"></script>
</body>
</html>
